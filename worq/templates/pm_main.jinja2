{% extends "workq_main.jinja2" %}

{% block content %}
<div class="container">
  <div class="form-box2">
    <div class="form-box">
      <div class="form-header">
        <h2 class="form-title">CREATE PROJECT</h2>
        <form id="create-project-form">
          <div class="form-inner">
            <input class="controls" type="text" id="name" name="name" placeholder="Name" required>

            <div class="date-group">
              <input type="date" id="startdate" name="startdate" required>
              <input type="date" id="enddate" name="enddate">
            </div>

            <textarea class="controls full-width" id="description" name="description" placeholder="Description"></textarea>

            <div class="icon-preview full-width">
              <img src="{{ request.static_url('worq:static/img/upload.png') }}" alt="icon preview">
              <button class="buttons" type="button" id="submit-button">CREATE</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('submit-button').addEventListener('click', async function () {
    const form = document.getElementById('create-project-form');
    const formData = new FormData(form);

    // Convertir FormData a un objeto JSON
    const jsonData = {};
    formData.forEach((value, key) => {
      jsonData[key] = value;
    });

    try {
      // Enviar los datos al servidor como JSON
      const response = await fetch('{{ request.route_url("pm_main") }}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(jsonData),
      });

      if (response.ok) {
        const result = await response.json();
        alert('Project created successfully!');
        console.log(result);
      } else {
        const error = await response.text();
        alert('Error: ' + error);
      }
    } catch (err) {
      console.error('Error:', err);
      alert('An unexpected error occurred.');
    }
  });
</script>
{% endblock %}