<!DOCTYPE html>
<html lang="{{request.locale_name}}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="pyramid web application">
    <meta name="author" content="Pylons Project">
    <link rel="shortcut icon" href="{{request.static_url('worq:static/workq.png')}}">

    <title>WorkQ</title>
    <link rel="stylesheet" href="{{request.static_url('worq:static/main.css')}}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Round|Material+Icons+Sharp|Material+Icons+Two+Tone"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    {% block styles %}
<link rel="stylesheet" href="{{request.static_url('worq:static/assets/pm.css')}}">
{% endblock %}

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
    <script src="{{request.static_url('worq:static/sidebar-scripts.js')}}"></script>
  </head>
  <body>
    <div id="mySidebar" class="sidebar" onmouseleave="closeNav()" onmouseover="openNav()">
      <!-- Top Branding -->
      <div class="sidebar-header">
        <img src="{{request.static_url('worq:static/workq.png')}}" class="sidebar-logo">
        <span class="sidebar-title">WorkQ</span>
      </div>

      <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search..." oninput="handleSearchInput(event)">
        <div id="autocomplete-results" class="autocomplete-results"></div>
      </div>

      <!-- Project List -->
      <ul class="sidebar-projects" id="sortable">
        {% for project in projects %}
          <li class="ui-state-default project-item {% if project.id == active_project_id %}selected{% endif %}">
            <div class="project-icon-wrapper {% if project.id == active_project_id %}selected{% endif %}">
              <img src="{{ request.static_url('worq:static/icons/project' ~ pid ~ '.png') }}" class="project-icon">
            </div>
            <span class="project-label">{{ project.name }}</span>
            <span class="material-icons-round">drag_indicator</span>
          </li>
        {% endfor %}
      </ul>
    </div>

    <div id="overlay-blur" class="blur-overlay"></div>
    
    <div class="toolbar">
      <div class=notification>
        <span class="toolbar-icon material-icons-round">notifications</span>
      </div>
      <div class="calendar">
        <span class="toolbar-icon material-icons-round">calendar_today</span>
      </div>
      <span class="toolbar-separator"></span>
      <div class="profile" id="profile-menu">
        <span class="toolbar-icon material-icons-round" id="profile-icon">account_circle</span>
        <ul id="dropdown-menu">
          <li><a href="{{ request.route_url('info_user') }}">Profile</a></li>
          <li><a href="">Tutorial</a></li>
          <li><a href="">Logout</a></li>
        </ul>
      </div>
    </div>

    <div class="main">
    {% block content %}
    {% endblock content %}
    </div>
    <script>
      const projects = {{ projects|tojson }};
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
          const profileIcon = document.getElementById('profile-icon');
          const dropdownMenu = document.getElementById('dropdown-menu');
          const profileContainer = document.getElementById('profile-menu');
      
          // Alternar visibilidad al hacer clic en el ícono
          profileIcon.addEventListener('click', function (event) {
            event.stopPropagation(); // Evita que el clic se propague
            dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
          });
      
          // Cerrar el menú si clickeás fuera
          document.addEventListener('click', function (event) {
            if (!profileContainer.contains(event.target)) {
              dropdownMenu.style.display = 'none';
            }
          });
        });
      </script>
  </body>
</html>
